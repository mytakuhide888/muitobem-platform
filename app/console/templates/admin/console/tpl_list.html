{% extends "admin/console/base.html" %}
{% load console_extras %}
{% block title %}返信テンプレート{% endblock %}
{% block breadcrumbs %}<div class="breadcrumbs"><a href="{% url 'console:index' %}">運用コンソール</a> › 返信テンプレート</div>{% endblock %}
{% block content %}

<form method="get" class="module" style="display:flex;gap:8px;align-items:center;">
  <select name="service">
    <option value="">すべて</option>
    <option value="common" {% if service == 'common' %}selected{% endif %}>共通</option>
    <option value="ig" {% if service == 'ig' %}selected{% endif %}>Instagram</option>
    <option value="th" {% if service == 'th' %}selected{% endif %}>Threads</option>
  </select>
  <input type="text" name="q" value="{{ q }}" placeholder="名称/キー/説明で検索" style="width:260px;">
  <button type="submit" class="button">絞り込み</button>
  <a href="{% url 'console:tpl_new' %}" class="button default" style="margin-left:auto;">新規作成</a>
  <a href="{% url 'console:tpl_export' %}" class="button">JSONエクスポート</a>
  <a href="{% url 'console:tpl_import' %}" class="button">インポート</a>
</form>

<table class="module">
  <thead><tr>
    <th>サービス</th><th>名称</th><th>キー</th><th>差し込み</th><th>更新</th><th>状態</th><th></th>
  </tr></thead>
  <tbody>
  {% for it in items %}
    <tr>
      <td>{{ it.get_service_display }}</td>
      <td>{{ it.name }}</td>
      <td><code>{{ it.key }}</code></td>
      <td>
        {% for v in it.content|regex_find:"{{\\s*([\\w\\.]+)\\s*}}" %}
          <code>{{ v.1 }}</code>{% if not forloop.last %}, {% endif %}
        {% empty %}-{% endfor %}
      </td>
      <td>{{ it.updated_at|date:"Y-m-d H:i" }}</td>
      <td>{% if it.is_active %}<span style="color:green">有効</span>{% else %}<span style="color:#888">無効</span>{% endif %}</td>
      <td><a class="button" href="{% url 'console:tpl_edit' it.pk %}">編集</a></td>
    </tr>
  {% empty %}
    <tr><td colspan="7">データがありません。</td></tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}
